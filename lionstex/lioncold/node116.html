<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>expand (2268)</TITLE>
<META NAME="description" CONTENT="expand (2268)">
<META NAME="keywords" CONTENT="lionc">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="lionc.css">

<LINK REL="next" HREF="node117.html">
<LINK REL="previous" HREF="node115.html">
<LINK REL="up" HREF="node102.html">
<LINK REL="next" HREF="node117.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html2151"
  HREF="node117.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="file:/usr/lib/latex2html/icons/next.png"></A> 
<A NAME="tex2html2147"
  HREF="node102.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="file:/usr/lib/latex2html/icons/up.png"></A> 
<A NAME="tex2html2141"
  HREF="node115.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="file:/usr/lib/latex2html/icons/prev.png"></A> 
<A NAME="tex2html2149"
  HREF="node4.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="file:/usr/lib/latex2html/icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html2152"
  HREF="node117.html">swtch revisited</A>
<B> Up:</B> <A NAME="tex2html2148"
  HREF="node102.html">Process Management</A>
<B> Previous:</B> <A NAME="tex2html2142"
  HREF="node115.html">setrun (2134)</A>
 &nbsp; <B>  <A NAME="tex2html2150"
  HREF="node4.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION0001214000000000000000">
expand (2268)</A>
</H2>

<P>
The comment at the beginning of this
procedure (2251) says most of what
needs to be said about the procedure,
except for the question of ``swapping
out'' when not enough core is available.

<P>
Note that ``expand'' takes no particular
notice of the contents of the user data
area or stack area.

<P>
<DL>
<DT><STRONG>2277:</STRONG></DT>
<DD>If the expansion is actually a
 contraction, then trim off the
 excess from the high address end;

<P>
</DD>
<DT><STRONG>2281:</STRONG></DT>
<DD>``savu'' stores the values of r5
 and r6 in ``u.u_rsav'';

<P>
</DD>
<DT><STRONG>2283:</STRONG></DT>
<DD>If sufficient main memory is not
 available ...

<P>
</DD>
<DT><STRONG>2284:</STRONG></DT>
<DD>The environment pointer and stack
 pointer are recorded again in
 ``u.u_ssav''. But note that since
 no new procedures have been
 entered, and since there has been
 no cumulative stack growth, the
 values recorded are the same as
 at line 2281;

<P>
</DD>
<DT><STRONG>2285:</STRONG></DT>
<DD>``xswap'' (4368) copies the core
 image for the process designated
 by its first parameter to disk.

<P>
Since the second parameter is
non-zero the main memory area
occupied by the data segment is
returned to the list of available
space.

<P>
However the computation continues
using the same area in main
memory until the next call on
``retu'' (2193) in ``swtch''.
</DD>
</DL>

<P>
Note also that the call on ``savu'' at
line 2189 in ``swtch'' stores new values
in ``u.u_rsav'' after the disk image has
been made (and therefore serves no useful purpose since the core image has
already been officially ``abandoned'');

<P>
<DL>
<DT><STRONG>2286:</STRONG></DT>
<DD>The ``SSWAP'' flag is set in the
 process's proc array element.
 (This is not swapped out, so the
 effect is not lost);

<P>
</DD>
<DT><STRONG>2287:</STRONG></DT>
<DD>``swtch'' is called, and the process, still running in its old
 area suspends itself. Since the
 call on ``xswap'' will have
 resulted in the ``SLOAD'' flag
 being switched off, there is no
 way that ``swtch'' will choose the
 process for immediate reactivation.
</DD>
</DL>

<P>
Only after the disk image has
been copied back into core again
can the process be activated
again. The ``return'' executed by
``swtch'' is a return to the procedure which called ``expand''.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html2151"
  HREF="node117.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="file:/usr/lib/latex2html/icons/next.png"></A> 
<A NAME="tex2html2147"
  HREF="node102.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="file:/usr/lib/latex2html/icons/up.png"></A> 
<A NAME="tex2html2141"
  HREF="node115.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="file:/usr/lib/latex2html/icons/prev.png"></A> 
<A NAME="tex2html2149"
  HREF="node4.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="file:/usr/lib/latex2html/icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html2152"
  HREF="node117.html">swtch revisited</A>
<B> Up:</B> <A NAME="tex2html2148"
  HREF="node102.html">Process Management</A>
<B> Previous:</B> <A NAME="tex2html2142"
  HREF="node115.html">setrun (2134)</A>
 &nbsp; <B>  <A NAME="tex2html2150"
  HREF="node4.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>

2010-05-03
</ADDRESS>
</BODY>
</HTML>
